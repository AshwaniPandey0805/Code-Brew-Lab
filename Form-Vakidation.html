<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Form with Radio and Checkbox</title>
    <script src="path/to/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="path/to/sweetalert2.min.css">


</head>
<style>
    .btn {
        background-color: green;
        padding: 10px 10px;
        margin-left: 10px;
        border: none;

    }

    .btn:hover {
        background-color: blue;
    }

    #btn1 {
        visibility: hidden;
    }

    #deleteAllbtn {
        visibility: hidden;
    }

    body {
        font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
    }
</style>

<body
    style="width: 100%; display: flex; flex-direction:column; align-content: center; flex-wrap: wrap; background-color: rgb(234, 209, 191);">




    <h1 style="color: white;">Simple Form with Radio and Checkbox</h1>

    <form style="display: flex; flex-direction:column; width: 30%;" onsubmit="return valid()" id="form">
        <label for="name">Name:</label>
        <input type="text" id="fname" name="name">
        <p id="username" style="color: red;margin: 0px;"></p>
        <p id="rname" style="color: red;margin: 0px;"></p>

        <br>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email">
        <p id="remail" style="color: red;margin: 0px;"></p>

        <br>
        <label for="number">phone:</label>
        <input type="phone" id="Uphone" name="phone">
        <p id="userphone" style="color: red;margin: 0px;"></p>
        <!-- <p id="rphone" style="color: red;margin: 0px;"></p> -->


        <br>
        <label>Gender:</label>
        <label for="male">
            <input type="radio" id="male" name="gender" value="male"> Male
        </label>
        <label for="female">
            <input type="radio" id="female" name="gender" value="female"> Female
        </label>
        <p id="rgender" style="color: red;"></p>
        <br>
        <label for="">Date of birth</label>
        <input type="date" name="date" max="2023-01-01" id="datee">
        <input type="text" id="age" name="age" value="your age" disabled>
        <p id="userdate" style="color: red;margin: 0px;"></p>
        <br>
        <label for="">course duration </label>
        <label for="">starting date</label>
        <input type="date" id="userstartdate" max="2023-01-01" name="startdate"> <br>
        <label for="">ending date</label>
        <input type="date" id="userenddate" name="enddate">
        <p id="used" style="color: red;"></p>
        <br>

        <label for="" id="pass">password:</label>
        <input type="password" id="password" name="password ">
        <p id="rpassword" style="color: red;margin: 0px;"></p>
        <p id="userpassword" style="color: red;margin: 0px;"></p>


        <br>
        <label for="" id="passconf">password Confirm:</label>
        <input type="password" id="Comfpassword" name="password ">
        <p id="rComfpassword" style="color: red;margin: 0px;"></p>
        <p id="userComfpassword" style="color: red;margin: 0px;"></p>
        <br>
        <label for="subscribe">
            <input type="checkbox" id="subscribe" name="subscribe" value="yes"> Terms and Conditions Tick
            <p id="rcheckbox" style="color: red;"></p>
        </label>
        <br>

        <label for="message">Message:</label>
        <textarea id="message" name="message" rows="4"></textarea>
        <br>

        <a href=""><input type="submit" value="Submit" class="btn"></a>




        <!-- <p class="btn" style="color: red;" ></p> -->
    </form>


    <div>
        <h1>Table data</h1>
        <table border="1" id="tabledata">
            <thead>
                <tr>
                    <th>select</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Gender</th>
                    <th>Date of birth</th>
                    <th>age</th>
                    <th>starting date</th>
                    <th>ending date</th>
                    <th>Password</th>
                    <th> delete </th>
                    <th> edit </th>


                </tr>
            </thead>
            <tbody>
            </tbody>

        </table>
        <button id="btn1" onclick="deleteSelectedRows()">delete select</button>
        <button id="deleteAllbtn" onclick="deleteAll()">Delete All</button>

    </div>



    <script>

        let data = []
        let form = document.getElementById("form")
        function deleteAll() {
            if (confirm("Are you sure?")) {
                localStorage.removeItem("userdata");

                clearTable();
                // form.reset()
            }
        }

        function showdata() {

            let storedData = JSON.parse(localStorage.getItem("userdata")) || [];

            clearTable();
            let table = document.getElementById("tabledata");
            storedData.forEach((value) => {
                let newRow = table.insertRow();
                newRow.innerHTML = `
            <td><input type="checkbox" class="select-checkbox"></td>
            <td>${value.name}</td>
            <td>${value.email}</td>
            <td>${value.phone}</td>
            <td>${value.gender}</td>
            <td>${value.date}</td>
            <td>${value.age}</td>
            <td>${value.startingdate}</td>
            <td>${value.endingdate}</td>
            <td>${value.password}</td>
            <td><button onclick="deleteRowByEmail('${value.email}')">Delete</button></td>
            <td><button onclick="editdata('${value.email}' )">edit</button></td>
         
            
        `;
            });
            document.getElementById("btn1").style.visibility = "visible"
            document.getElementById("deleteAllbtn").style.visibility = "visible"

            console.log(data);


        }
        function clearTable() {
            const table = document.getElementById("tabledata");
            while (table.rows.length > 1) {
                table.deleteRow(1);

            }
            document.getElementById("btn1").style.visibility = "hidden";
            document.getElementById("deleteAllbtn").style.visibility = "hidden";

        }
        function checkEmailExists(email) {
            let storedData = JSON.parse(localStorage.getItem("userdata")) || [];
            return storedData.some(user => user.email === email);
        }

        function phoneNotexist(phone) {
            let storedData = JSON.parse(localStorage.getItem("userdata")) || [];
            return storedData.some(user => user.phone === phone);
        }




        function editdata(email) {
            let storedData = JSON.parse(localStorage.getItem("userdata")) || [];
            let btn1 = document.querySelector(".btn");

            btn1.value = "Edit";
            btn1.type = "none"

            let user = storedData.find(u => u.email === email);
            if (user) {
                document.getElementById("fname").value = user.name;
                document.getElementById("email").value = user.email;
                document.getElementById("Uphone").value = user.phone;
                document.getElementById("password").value = user.password
                document.getElementById("Comfpassword").value = user.password

                document.getElementById("password").style.visibility = "hidden"
                document.getElementById("Comfpassword").style.visibility = "hidden"
                if (user.gender === "male") {
                    document.getElementById("male").checked = true;
                } else if (user.gender === "female") {
                    document.getElementById("female").checked = true;
                }
                document.getElementById("subscribe").checked = true
                document.getElementById("datee").value = user.date
                document.getElementById("age").value = user.age
                document.getElementById("userstartdate").value = user.startingdate
                document.getElementById("userenddate").value = user.endingdate
                document.getElementById("pass").style.visibility = "hidden"
                document.getElementById("passconf").style.visibility = "hidden"




                function editAction() {
                    editUser(email);

                    btn1.removeEventListener("click", editAction);

                }



                btn1.addEventListener("click", editAction);
            }
        }

        function editUser(email) {
            let storedData = JSON.parse(localStorage.getItem("userdata")) || [];
            let userIndex = storedData.findIndex(user => user.email === email);

            if (userIndex !== -1) {
                storedData[userIndex] = {
                    name: name.value,
                    email: remail.value,
                    phone: phone.value,
                    gender: gendermale.checked ? "male" : "female",
                    date: datee.value,
                    age: calculateAge(datee.value),
                    startingdate: userstartdate.value,
                    endingdate: userenddate.value,
                    password: password.value
                };

                alert("Update the data");
                localStorage.setItem("userdata", JSON.stringify(storedData));

                showdata();

            }

            document.querySelector('.btn').value = 'Submit';
            document.querySelector('.btn').removeEventListener('click', editUser);

        }




        let name = document.getElementById("fname")
        let rname = "^[A-Za-z\s]{1,}[\.]{0,1}[A-Za-z\s]{0,}$"
        let remail = document.getElementById("email")
        let rezex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        let phone = document.getElementById("Uphone")
        let password = document.getElementById("password")
        let Comfpassword = document.getElementById("Comfpassword")
        let gendermale = document.getElementById("male")
        let genderfemale = document.getElementById("female")
        let checkb = document.getElementById("subscribe")

        let dateuser = document.getElementById("datee")
        let agee = document.getElementById("age")
        let userstartdate = document.getElementById("userstartdate");
        let userenddate = document.getElementById("userenddate");

        userstartdate.addEventListener("change", function () {
            userenddate.min = userstartdate.value
        })
        let validd = 0;


        function valid() {
            validd = 11;
            if (name.value == "") {
                document.getElementById("username").innerHTML = "name is required"
                validd--;

            } else if (name.value.length < 3) {
                document.getElementById("username").innerHTML = "name is min 3 chr"
                validd--;

            } else if (!name.value.match(rname)) {
                document.getElementById("username").innerHTML = "Please enter a valid name";
                validd--;
            }
            else {
                document.getElementById("username").innerHTML = ""
                validd++;
            }
            if (remail.value == "") {
                document.getElementById("remail").innerHTML = "email are required"
                validd--;

            } else if (!remail.value.match(rezex)) {
                document.getElementById("remail").innerHTML = "enter vaild e-mail"
                validd--;
            } else if (checkEmailExists(remail.value)) {
                document.getElementById("remail").innerHTML = "Email already exists";
                validd--;
            }
            else {
                document.getElementById("remail").innerHTML = ""
                validd++;

            }

            if (phone.value == "") {
                document.getElementById("userphone").innerHTML = "phone is required"
                validd--;


            } else if (phone.value.length < 10) {
                document.getElementById("userphone").innerHTML = "must be of 10 digit"
                validd--;

            }
            else if (phone.value.length >= 10) {
                if (phoneNotexist(phone.value)) {
                    document.getElementById("userphone").innerHTML = "phone is already exist"
                    validd--;

                } else {

                    document.getElementById("userphone").innerHTML = ""
                    validd++;
                }

            } else {
                document.getElementById("userphone").innerHTML = ""
                validd++
            }


            if (!gendermale.checked && !genderfemale.checked) {
                document.getElementById("rgender").innerHTML = "Select your gender";
                validd--;


            } else {
                document.getElementById("rgender").innerHTML = "";
                validd++;


            }
            if (!dateuser.value) {
                document.getElementById("userdate").innerHTML = "date of birth is required"
                validd--;
            } else {
                document.getElementById("userdate").innerHTML = ""
                validd++;
                if (isNaN(calculateAge(dateuser.value))) {
                    document.getElementById("age").value = " 0";
                } else {
                    document.getElementById("age").value =
                        "" + calculateAge(dateuser.value);
                }
            }

            if (!userstartdate.value) {
                document.getElementById("used").innerHTML = "Select course duration";
                validd--;
            } else {
                document.getElementById("used").innerHTML = "";
                validd++;
            }


            if (password.value == "") {
                document.getElementById("userpassword").innerHTML = "Password is required";
                validd--;
                ;
            } else if (password.value.length < 8) {
                document.getElementById("userpassword").innerHTML = "Password must be at least 8 characters";
                validd--;
            } else {
                document.getElementById("userpassword").innerHTML = "";
                validd++;
            }
            if (Comfpassword.value == "") {
                document.getElementById("rComfpassword").innerHTML = "password confirm required"
                validd--;
            } else if (password.value !== Comfpassword.value) {
                document.getElementById("rComfpassword").innerHTML = "please confirm password"
                validd--
            } else {
                document.getElementById("rComfpassword").innerHTML = ""
                validd++;
            }

            if (!checkb.checked) {
                document.getElementById("rcheckbox").innerHTML = "please tick"
                validd--;
            } else {
                document.getElementById("rcheckbox").innerHTML = "";
                validd++;
            }



            if (validd >= 20) {
                let userdata = {
                    name: name.value,
                    email: email.value,
                    phone: Uphone.value,
                    gender: gendermale.checked ? "male" : "female",
                    date: datee.value,
                    age: age.value,
                    startingdate: userstartdate.value,
                    endingdate: userenddate.value,
                    password: password.value
                };
                let storedData = JSON.parse(localStorage.getItem("userdata")) || [];
                storedData.push(userdata);
                data = storedData;
                alert("submit your data ")

                localStorage.setItem("userdata", JSON.stringify(storedData));
                // window.open("submit.html")
                form.reset()
                showdata();
            }

            return false;

        }
        // function cleardata() {
        //     localStorage.clear()
        //     window.location.reload()
        // }



        function deleteRowByEmail(email) {
            let storedData = JSON.parse(localStorage.getItem("userdata")) || [];
            let emailI = data.findIndex((val) => val.email === email)
            if (emailI !== -1) {
                storedData.splice(emailI, 1);
            }
            localStorage.setItem("userdata", JSON.stringify(storedData));
            showdata();
            clearTable();

        }


        function calculateAge(birthdate) {
            const today = new Date();
            const birthDate = new Date(birthdate);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();

            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }

            return age;
        }

        document.getElementById("selectAll").addEventListener("click", function () {
            let checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach((checkbox) => checkbox.checked = this.checked);
        });
        function deleteRow(rowIndex) {
            let table = document.getElementById("tabledata");
            table.deleteRow(rowIndex);
        }
        function deleteSelectedRows() {
            let checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            let storedData = JSON.parse(localStorage.getItem("userdata")) || [];

            checkboxes.forEach((checkbox) => {
                let row = checkbox.parentNode.parentNode;
                let rowIndex = row.rowIndex;
                storedData.splice(rowIndex - 1, 1);
                localStorage.setItem("userdata", JSON.stringify(storedData));
                deleteRow(rowIndex);
                clearTable();

            });
        }
    </script>


</body>


</html>